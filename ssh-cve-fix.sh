echo "1-下载安装包..."
wget --no-check-certificate http://www.zlib.net/zlib-1.3.1.tar.gz
wget --no-check-certificate https://www.openssl.org/source/openssl-3.0.2.tar.gz
wget --no-check-certificate https://mirrors.aliyun.com/pub/OpenBSD/OpenSSH/portable/openssh-9.3p2.tar.gz


echo "2-解压缩"
tar xzf zlib-1.3.1.tar.gz
tar xzf openssl-3.0.2.tar.gz
tar xzf openssh-9.3p2.tar.gz


echo "3-安装依赖"
apt install -y g++ perl make libpam0g-dev build-essential

echo "4-安装Telnet"
apt install openbsd-inetd telnetd telnet -y
systemctl restart openbsd-inetd
systemctl status openbsd-inetd
netstat -anpt|grep 23

echo "5-卸载旧openssh"
apt-get autoremove openssh-server openssh-client -y

echo "6-安装zlib"
cd zlib-1.3.1/
./configure --shared
make -j4 && make install
cd ..


echo "7-安装openssl"
cd openssl-3.0.2
./config --prefix=/usr/local/openssl shared zlib
make depend
make -j4 && make install

echo "7-1配置openssl"
sudo mv /usr/bin/openssl /usr/bin/openssl.bak
sudo ln -sv /usr/local/openssl/bin/openssl /usr/bin/openssl
echo "/usr/local/openssl/lib64" >> /etc/ld.so.conf
ldconfig -v
openssl version
cd ..


echo "8-安装openssh"
cd openssh-9.3p2
./configure --prefix=/usr --sysconfdir=/etc/ssh --with-md5-passwords --with-pam --with-zlib --with-ssl-dir=/usr/include/openssl --with-privsep-path=/var/lib/ssh
make depnd
make -j4 && make install
cd ..

echo "8-1配置openssh"
systemctl unmask ssh.service
systemctl start sshd
systemctl status sshd


echo "9-关闭Telnet"
systemctl status openbsd-inetd
systemctl disable openbsd-inetd
systemctl stop openbsd-inetd
systemctl status openbsd-inetd

